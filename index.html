<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Steve & Liz ‚òïüíõ</title>
  <style>
    :root{
      --shadow: rgba(0,0,0,.18);
      --panel: rgba(255,255,255,.78);
      --panel2: rgba(255,255,255,.95);

      --sky1:#bfe9ff;
      --sky2:#f8fbff;
      --grass:#b7f0c2;

      --warm1:#ffdf9b;
      --warm2:#ffb7d7;
      --warm3:#a7ecff;

      --table:#f1c7a3;
      --table2:#e7b48f;

      --cup:#ffffff;
      --coffee:#7a4b2a;

      --heart:#ff4f9a;
      --heart2:#ff74b5;
      --heart3:#ff3b8c;

      --steveY:#ffd84a;
      --steveY2:#ffef94;
      --steveO:#ff9b3d;
      --steveEye:#22c55e;

      --lizSkin:#ffe6de;
      --lizHair:#2a1f17;
      --lizDress:#ff5fa8;
      --lizDress2:#ff8dc1;

      --safePad: clamp(10px, 3vw, 22px);

      --titleH: clamp(46px, 6vh, 68px);
      --tableH: clamp(110px, 18vh, 200px);
      --charW: clamp(210px, 30vw, 380px);

      --charScale: 1;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"Segoe UI Emoji","Apple Color Emoji";
      background:
        radial-gradient(1200px 700px at 20% 15%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(900px 600px at 80% 15%, rgba(255,210,232,.55), transparent 55%),
        linear-gradient(180deg, var(--sky1) 0%, var(--sky2) 55%, var(--grass) 100%);
      overflow:hidden;
    }

    .wrap{
      height: 100dvh;
      width: 100%;
      padding: var(--safePad);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .scene{
      width: min(1280px, 100%);
      height: calc(100dvh - (var(--safePad) * 2));
      max-height: 860px;
      min-height: 560px;
      position:relative;
      border-radius: clamp(18px, 2.2vw, 28px);
      overflow:hidden;
      box-shadow: 0 18px 60px var(--shadow);
      border:1px solid rgba(255,255,255,.55);
      background:
        radial-gradient(700px 420px at 25% 25%, rgba(255,255,255,.65), rgba(255,255,255,0) 60%),
        radial-gradient(700px 420px at 80% 35%, rgba(255,255,255,.5), rgba(255,255,255,0) 62%),
        linear-gradient(180deg, rgba(255,255,255,.22) 0%, rgba(255,255,255,.06) 60%, rgba(0,0,0,.03) 100%);
      backdrop-filter: blur(6px);
    }

    .layout{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-rows: var(--titleH) 1fr auto; /* T√çTULO / ESCENA / PANEL */
      z-index: 2;
      min-height: 100%;
    }

    /* Caf√© BG */
    .cafeBg{ position:absolute; inset:0; pointer-events:none; z-index:0; }
    .cafeBg .wall{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 360px at 50% 14%, rgba(255, 245, 225, .55), rgba(255,255,255,0) 62%),
        radial-gradient(850px 340px at 20% 30%, rgba(255, 210, 232, .28), rgba(255,255,255,0) 62%),
        radial-gradient(850px 340px at 80% 30%, rgba(170, 240, 255, .28), rgba(255,255,255,0) 62%),
        linear-gradient(180deg, rgba(255,255,255,.05) 0%, rgba(0,0,0,.02) 70%, rgba(0,0,0,.06) 100%);
    }
    .cafeBg .window{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      top: clamp(10px, 1.8vh, 18px);
      width: min(880px, 94%);
      height: clamp(110px, 15vh, 175px);
      border-radius: 26px;
      background:
        radial-gradient(120px 120px at 20% 30%, rgba(255,255,255,.30), transparent 60%),
        radial-gradient(160px 120px at 70% 35%, rgba(255,255,255,.22), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.24), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: 0 18px 50px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
      overflow:hidden;
      opacity:.95;
    }
    .cafeBg .window:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        linear-gradient(90deg,
          rgba(255,255,255,.20) 0 1px, transparent 1px 33%,
          rgba(255,255,255,.18) 33% calc(33% + 1px), transparent calc(33% + 1px) 66%,
          rgba(255,255,255,.18) 66% calc(66% + 1px), transparent calc(66% + 1px) 100%),
        linear-gradient(180deg,
          rgba(255,255,255,.18) 0 1px, transparent 1px 50%,
          rgba(255,255,255,.16) 50% calc(50% + 1px), transparent calc(50% + 1px) 100%);
      opacity:.55;
    }

    /* Bokeh */
    .bokeh{ position:absolute; inset:0; z-index:1; pointer-events:none; overflow:hidden; }
    .orb{
      position:absolute;
      width: clamp(90px, 13vw, 210px);
      aspect-ratio:1/1;
      border-radius:50%;
      filter: blur(16px);
      opacity:.9;
      animation: drift 10s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    .orb:nth-child(1){left:8%; top:16%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), var(--warm1)); animation-duration: 12s;}
    .orb:nth-child(2){left:72%; top:18%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.30), var(--warm2)); animation-duration: 14s; animation-delay:-5s;}
    .orb:nth-child(3){left:48%; top:6%;  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.30), var(--warm3)); animation-duration: 16s; animation-delay:-8s;}
    .orb:nth-child(4){left:18%; top:52%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.28), var(--warm2)); animation-duration: 13s; animation-delay:-4s;}
    .orb:nth-child(5){left:78%; top:55%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.28), var(--warm1)); animation-duration: 15s; animation-delay:-7s;}
    @keyframes drift{ 0%,100%{ transform: translate(0,0) scale(1); } 50%{ transform: translate(18px, -16px) scale(1.08); } }

    /* Sun + clouds */
    .sun{
      position:absolute;
      top: clamp(10px, 2.2vw, 18px);
      right: clamp(10px, 2.2vw, 18px);
      width: clamp(56px, 7.2vw, 92px);
      aspect-ratio:1/1;
      border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, #fff9, transparent 45%),
        radial-gradient(circle at 40% 40%, #fff7, transparent 50%),
        #ffd36a;
      filter: drop-shadow(0 12px 22px rgba(255,170,0,.25));
      animation: floatSun 4.6s ease-in-out infinite;
      z-index:4;
      pointer-events:none;
    }
    @keyframes floatSun{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
    .cloud{
      position:absolute;
      top: 18%;
      left:-30%;
      width: clamp(200px, 27vw, 380px);
      height: clamp(76px, 10.5vw, 130px);
      background: rgba(255,255,255,.78);
      border-radius: 999px;
      box-shadow: 0 16px 30px rgba(0,0,0,.06);
      animation: cloudMove 22s linear infinite;
      z-index:4;
      filter: blur(.2px);
      pointer-events:none;
    }
    .cloud:before,.cloud:after{content:"";position:absolute;background:rgba(255,255,255,.82);border-radius:999px}
    .cloud:before{width:55%;height:85%;left:10%;top:-35%}
    .cloud:after{width:48%;height:75%;right:14%;top:-22%}
    .cloud.c2{top:32%;left:-42%;opacity:.9;transform:scale(.92);animation-duration:28s;animation-delay:-10s}
    @keyframes cloudMove{0%{transform:translateX(0)}100%{transform:translateX(190%)}}

    /* Hearts */
    .heartsLayer{ position:absolute; inset:0; pointer-events:none; z-index:30; }
    .heart{
      position:absolute;
      width: 18px; height: 18px;
      transform: rotate(45deg);
      opacity:.92;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.10));
      animation: rise linear forwards;
      background: currentColor;
      color: var(--heart);
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: currentColor;
    }
    .heart:before{ left:-9px; top:0; }
    .heart:after { left:0; top:-9px; }
    @keyframes rise{
      from{ transform: translateY(0) rotate(45deg) scale(.75); opacity:0 }
      12%{opacity:.98}
      to  { transform: translateY(-190px) rotate(45deg) scale(1.22); opacity:0 }
    }

    /* Title chip */
    .titleBar{
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      z-index: 10;
      pointer-events:none;
    }
    .neon{
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,.22);
      border: 1px solid rgba(255,255,255,.52);
      box-shadow: 0 18px 40px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
      max-width: min(92%, 760px);
    }
    .neon span{
      font-weight: 1000;
      letter-spacing:.3px;
      font-size: clamp(13px, 2.2vw, 18px);
      color: rgba(20,20,30,.86);
      text-shadow:
        0 0 10px rgba(255, 90, 170, .30),
        0 0 16px rgba(255, 220, 120, .25),
        0 0 22px rgba(160, 240, 255, .25);
      white-space:nowrap;
      display:block;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Stage */
    .stage{
      position:relative;
      overflow:hidden;
      z-index: 10;
      min-height: 260px;
    }

    /* Table (PEGADA AL FONDO DEL STAGE, NO AL PANEL) */
    .tableWrap{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom: 12px; /* <-- FIX */
      width: min(900px, 95%);
      height: var(--tableH);
      z-index:11;
      pointer-events:none;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.14));
    }
    .tableTop{
      position:absolute;
      inset:0;
      border-radius: 28px;
      background:
        radial-gradient(260px 95px at 30% 35%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(320px 120px at 70% 40%, rgba(255,255,255,.22), transparent 60%),
        linear-gradient(180deg, var(--table) 0%, var(--table2) 100%);
      border: 1px solid rgba(255,255,255,.55);
    }
    .tableEdge{
      position:absolute;
      left:18px; right:18px; bottom:-16px;
      height: 38px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.03));
      opacity:.28;
    }
    .cookie{
      position:absolute;
      width: clamp(42px, 5.5vw, 56px);
      height: clamp(42px, 5.5vw, 56px);
      border-radius: 50%;
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(circle at 65% 70%, rgba(0,0,0,.10), transparent 60%),
        linear-gradient(180deg, #e7b785, #d99a5e);
      border: 1px solid rgba(255,255,255,.45);
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
      top: 22%;
      opacity:.95;
    }
    .cookie.c1{ left: 18%; transform: rotate(-10deg); }
    .cookie.c2{ right: 18%; transform: rotate(14deg) scale(.92); }

    /* Characters (SIN padding-bottom del panel; escala autom√°tica) */
    .characters{
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      padding: var(--safePad);
      padding-bottom: 32px; /* <-- FIX */
      gap: clamp(10px, 3vw, 40px);
      z-index:12;
      pointer-events:none;
      transform: scale(var(--charScale));
      transform-origin: 50% 100%;
    }

    .char{
      width: var(--charW);
      max-width: 48%;
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      user-select:none;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.14));
      transform-origin: 50% 100%;
      transition: transform .35s ease;
      padding-top: 78px;
    }

    .nameTag{
      position:absolute;
      top: 8px;
      left:50%;
      transform: translate(calc(-50% + var(--clampX, 0px)), calc(0px + var(--clampY, 0px)));
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.90);
      border: 1px solid rgba(255,255,255,.92);
      box-shadow: 0 12px 22px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
      font-weight: 1000;
      letter-spacing:.2px;
      font-size: clamp(13px, 2.2vw, 18px);
      display:flex;
      align-items:center;
      gap: 8px;
      z-index:40;
      white-space:nowrap;
      max-width: 92%;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .nameTag small{font-weight:900;opacity:.75;font-size:.88em}

    .bubble{
      position:absolute;
      left:50%;
      bottom: calc(100% - 2px);
      transform: translate(calc(-50% + var(--clampX, 0px)), calc(0px + var(--clampY, 0px)));
      width: min(520px, 90vw);
      max-width: 560px;
      background: var(--panel2);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 18px;
      padding: 10px 12px;
      box-shadow: 0 18px 36px rgba(0,0,0,.12);
      backdrop-filter: blur(14px);
      opacity: 0;
      transition: opacity .22s ease;
      z-index:42;
      pointer-events:none;
    }
    .bubble.show{ opacity:1; }
    .bubble .who{
      font-weight: 1000;
      font-size: 13px;
      opacity: .78;
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom: 6px;
      white-space:nowrap;
    }
    .bubble .msg{
      font-weight: 1000;
      font-size: clamp(14px, 2.4vw, 16px);
      line-height: 1.25;
      color: rgba(20,20,30,.92);
      word-wrap: break-word;
    }
    .bubble:after{
      content:"";
      position:absolute;
      width: 16px; height: 16px;
      background: var(--panel2);
      border-left: 1px solid rgba(0,0,0,.06);
      border-bottom: 1px solid rgba(0,0,0,.06);
      transform: rotate(45deg);
      bottom: -8px;
      left: 34px;
    }
    .bubble.right:after{ left:auto; right:34px; }

    /* Idle */
    .steve { animation: bob 1.9s ease-in-out infinite; }
    .liz   { animation: sway 2.6s ease-in-out infinite; }
    @keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    @keyframes sway{0%,100%{transform:rotate(-1.4deg) translateY(0)}50%{transform:rotate(1.7deg) translateY(-6px)}}

    /* Look */
    .lookLeft  { transform: rotate(-4.2deg) translateY(-2px); }
    .lookRight { transform: rotate(4.2deg) translateY(-2px); }

    /* Eye gaze */
    svg{ --gazeX: 0px; --gazeY: 0px; }
    .pupilMove{ transform: translate(var(--gazeX), var(--gazeY)); transition: transform .18s ease; }

    /* Love mode */
    .loveMode .eyeNormal{ opacity:0; }
    .loveMode .eyeHeart{ opacity:1; }

    /* Talking */
    .talkingSteve .lowerBeak{
      animation: beakTalk .11s ease-in-out infinite;
      transform-origin: 130px 126px;
    }
    @keyframes beakTalk{ 0%,100%{ transform: rotate(0deg); } 50%{ transform: rotate(16deg); } }
    .talkingLiz .mouthClosed{ opacity:0; }
    .talkingLiz .mouthOpen{ opacity:1; }

    /* Sip */
    .sipSteve #steveCupWrap{ animation: sipCupSteve 1.25s ease-in-out infinite; transform-origin: 118px 178px; }
    .sipLiz   #lizCupWrap  { animation: sipCupLiz   1.25s ease-in-out infinite; transform-origin: 168px 178px; }
    @keyframes sipCupSteve{
      0%,100%{ transform: translate(0,0) rotate(0deg); }
      45%{ transform: translate(42px,-98px) rotate(-16deg); }
      70%{ transform: translate(42px,-98px) rotate(-16deg); }
    }
    @keyframes sipCupLiz{
      0%,100%{ transform: translate(0,0) rotate(0deg); }
      45%{ transform: translate(-36px,-98px) rotate(16deg); }
      70%{ transform: translate(-36px,-98px) rotate(16deg); }
    }

    /* Steam */
    .steamPath{
      fill:none;
      stroke: rgba(255,255,255,.82);
      stroke-width: 3.2;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: blur(.45px);
      opacity: 0;
      animation: steamRise 1.9s ease-in-out infinite;
    }
    .steamPath.s2{ animation-delay: .35s; }
    .steamPath.s3{ animation-delay: .7s; }
    @keyframes steamRise{
      0%   { opacity:0; transform: translateY(12px) translateX(0px) scale(.98); }
      18%  { opacity:.78; }
      55%  { opacity:.56; transform: translateY(-14px) translateX(2px) scale(1.02); }
      100% { opacity:0; transform: translateY(-34px) translateX(-2px) scale(1.06); }
    }

    /* Bottom drawer panel */
    .panelWrap{
      width: 100%;
      display:flex;
      justify-content:center;
      z-index: 60;
      padding: 10px 10px max(10px, env(safe-area-inset-bottom));
    }

    .panel{
      width: min(1120px, calc(100% - 12px));
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.86);
      box-shadow: 0 18px 46px rgba(0,0,0,.12);
      border-radius: 18px;
      backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }
    .handleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.65);
      background: rgba(255,255,255,.52);
      user-select:none;
      cursor:pointer;
    }
    .grab{
      display:flex;
      align-items:center;
      gap: 10px;
      font-weight: 1000;
      font-size: 13px;
      opacity:.9;
    }
    .bar{
      width: 44px; height: 6px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
    }
    .miniBtn{
      border: 1px solid rgba(255,255,255,.88);
      background: rgba(255,255,255,.78);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      box-shadow: 0 12px 20px rgba(0,0,0,.10);
      font-weight: 1000;
      font-size: 12px;
      white-space:nowrap;
    }
    .miniBtn:active{ transform: translateY(1px); }

    .panelBody{
      padding: 12px 12px;
      max-height: min(46vh, 360px);
      overflow:auto;
    }
    .panel.collapsed .panelBody{
      max-height: 0px;
      padding-top: 0;
      padding-bottom: 0;
      overflow:hidden;
    }

    .panelRow{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .seg{
      display:flex;
      gap: 10px;
      align-items:center;
      background: rgba(255,255,255,.62);
      border:1px solid rgba(255,255,255,.90);
      border-radius: 14px;
      padding: 10px 10px;
      box-shadow: 0 12px 22px rgba(0,0,0,.06);
      flex: 0 0 auto;
    }
    .seg label{
      font-weight:1000;
      font-size:13px;
      opacity:.92;
      display:flex;
      gap:8px;
      align-items:center;
      cursor:pointer;
      white-space:nowrap;
    }
    .seg input{accent-color: var(--heart)}

    .input{
      flex: 1 1 360px;
      min-width: min(520px, 100%);
      display:flex;
      gap: 10px;
      align-items:center;
      background: rgba(255,255,255,.96);
      border:1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .input input{
      width:100%;
      min-width: 180px;
      border:0;
      outline:none;
      font-size: 15px;
      font-weight: 1000;
      background: transparent;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.88);
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(10px);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
      font-weight: 1000;
      letter-spacing: .2px;
      font-size: 13px;
      display:flex;
      gap: 8px;
      align-items:center;
      user-select:none;
      transition: transform .08s ease, background .2s ease;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.94); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .hint{
      font-size:12px;
      opacity:.80;
      margin-top:8px;
      font-weight:950;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 120, 180, .14);
      border: 1px solid rgba(255, 120, 180, .22);
      font-weight: 1000;
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }

    .toast{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 10px;
      z-index: 70;
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(255,255,255,.92);
      box-shadow: 0 18px 36px rgba(0,0,0,.12);
      backdrop-filter: blur(14px);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      white-space:nowrap;
      max-width: 92%;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(6px); }

    /* MOBILE PORTRAIT */
    @media (max-width: 640px) and (orientation: portrait){
      .scene{
        max-height: none;
        height: calc(100dvh - (var(--safePad) * 2));
        min-height: 620px;
      }
      :root{
        --tableH: clamp(88px, 12.5vh, 130px);
        --charW: clamp(150px, 44vw, 210px);
        --titleH: clamp(44px, 6.5vh, 64px);
      }
    }
    @media (max-width: 380px) and (orientation: portrait){
      :root{
        --charW: clamp(140px, 46vw, 190px);
        --tableH: clamp(78px, 11vh, 110px);
      }
      .cookie{ display:none; }
    }
    @media (max-width: 520px){
      .panelRow{ flex-direction: column; align-items: stretch; }
      .seg{ width: 100%; justify-content: center; }
      .btn{ width: 100%; justify-content: center; }
      .hint{ justify-content:center; }
      .input{ min-width: 100%; }
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition:none !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="scene" id="scene">
      <div class="cafeBg" aria-hidden="true">
        <div class="wall"></div>
        <div class="window"></div>
      </div>

      <div class="bokeh" aria-hidden="true">
        <div class="orb"></div><div class="orb"></div><div class="orb"></div><div class="orb"></div><div class="orb"></div>
      </div>

      <div class="sun" aria-hidden="true"></div>
      <div class="cloud" aria-hidden="true"></div>
      <div class="cloud c2" aria-hidden="true"></div>

      <div class="toast" id="toast">‚ú®</div>
      <div class="heartsLayer" id="heartsLayer" aria-hidden="true"></div>

      <div class="layout">
        <div class="titleBar" aria-hidden="true">
          <div class="neon"><span>‚òï Cafecito de Steve & Liz ‚ú®</span></div>
        </div>

        <div class="stage" id="stage">
          <div class="tableWrap" aria-hidden="true">
            <div class="tableTop"></div>
            <div class="cookie c1"></div>
            <div class="cookie c2"></div>
            <div class="tableEdge"></div>
          </div>

          <div class="characters" id="characters">
            <!-- Steve -->
            <div class="char" id="steveChar">
              <div class="nameTag" id="steveTag">üê• <strong>Steve</strong> <small>pollito</small></div>

              <div class="bubble" id="steveBubble">
                <div class="who">üê• Steve dice:</div>
                <div class="msg" id="steveMsg">...</div>
              </div>

              <svg id="steveSvg" class="steve" width="100%" viewBox="0 0 260 260" role="img" aria-label="Steve el pollito con caf√©">
                <defs>
                  <radialGradient id="gChick" cx="35%" cy="30%" r="80%">
                    <stop offset="0%" stop-color="var(--steveY2)"/>
                    <stop offset="75%" stop-color="var(--steveY)"/>
                  </radialGradient>
                  <radialGradient id="gSpec" cx="30%" cy="25%" r="60%">
                    <stop offset="0%" stop-color="rgba(255,255,255,.55)"/>
                    <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                  </radialGradient>
                </defs>

                <ellipse cx="130" cy="238" rx="84" ry="16" fill="rgba(0,0,0,.10)"/>

                <ellipse cx="130" cy="155" rx="96" ry="82" fill="url(#gChick)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>
                <ellipse cx="118" cy="132" rx="64" ry="46" fill="url(#gSpec)" opacity=".65"/>
                <ellipse cx="130" cy="172" rx="64" ry="50" fill="rgba(255,255,255,.16)"/>

                <path d="M55 154 C30 156, 28 192, 66 196 C96 199, 106 172, 96 160 C90 149, 72 149, 55 154Z"
                      fill="rgba(255,255,255,.16)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>
                <path d="M205 154 C230 156, 232 192, 194 196 C164 199, 154 172, 164 160 C170 149, 188 149, 205 154Z"
                      fill="rgba(255,255,255,.16)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>

                <circle cx="130" cy="92" r="70" fill="url(#gChick)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>
                <ellipse cx="118" cy="70" rx="50" ry="38" fill="url(#gSpec)" opacity=".70"/>

                <g>
                  <g class="eyeNormal">
                    <circle cx="104" cy="88" r="18" fill="#fff" stroke="rgba(0,0,0,.12)" stroke-width="3"/>
                    <circle cx="156" cy="88" r="18" fill="#fff" stroke="rgba(0,0,0,.12)" stroke-width="3"/>
                    <circle cx="106" cy="90" r="10.2" fill="var(--steveEye)"/>
                    <circle cx="158" cy="90" r="10.2" fill="var(--steveEye)"/>
                    <circle class="pupilMove" cx="110" cy="94" r="3.5" fill="rgba(0,0,0,.55)"/>
                    <circle class="pupilMove" cx="162" cy="94" r="3.5" fill="rgba(0,0,0,.55)"/>
                    <circle cx="102" cy="84" r="3.2" fill="rgba(255,255,255,.95)"/>
                    <circle cx="154" cy="84" r="3.2" fill="rgba(255,255,255,.95)"/>
                  </g>

                  <g class="eyeHeart" opacity="0">
                    <path d="M92 86 C92 77, 104 77, 106 85 C108 77, 120 77, 120 86
                             C120 97, 106 102, 106 102 C106 102, 92 97, 92 86Z"
                          fill="var(--heart3)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                    <path d="M142 86 C142 77, 154 77, 156 85 C158 77, 170 77, 170 86
                             C170 97, 156 102, 156 102 C156 102, 142 97, 142 86Z"
                          fill="var(--heart3)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                  </g>
                </g>

                <g id="steveBeak">
                  <path d="M130 108
                           C118 114, 112 120, 110 126
                           C118 130, 142 130, 150 126
                           C148 120, 142 114, 130 108Z"
                        fill="var(--steveO)" stroke="rgba(0,0,0,.12)" stroke-width="3"/>
                  <g class="lowerBeak">
                    <path d="M110 126
                             C118 142, 142 142, 150 126
                             C142 136, 118 136, 110 126Z"
                          fill="#ffb36b" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                  </g>
                </g>

                <path d="M95 225 C90 235, 95 242, 114 241 C112 234, 104 228, 95 225Z" fill="var(--steveO)" opacity=".95"/>
                <path d="M165 225 C170 235, 165 242, 146 241 C148 234, 156 228, 165 225Z" fill="var(--steveO)" opacity=".95"/>

                <g id="steveCupWrap">
                  <g id="steveCup">
                    <path d="M100 192 C96 192, 92 188, 92 184 V176 C92 172, 96 170, 100 170 H134 C138 170, 142 172, 142 176 V184
                             C142 188, 138 192, 134 192 H100Z"
                          fill="var(--cup)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                    <path d="M138 176 C150 178, 150 188, 138 188" fill="none" stroke="rgba(0,0,0,.12)" stroke-width="5" stroke-linecap="round"/>
                    <path d="M98 178 H136" stroke="rgba(0,0,0,.07)" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="117" cy="176" rx="18" ry="5" fill="var(--coffee)" opacity=".92"/>

                    <path class="steamPath s1" d="M106 166 C110 160, 114 160, 116 154 C118 148, 112 146, 112 140" />
                    <path class="steamPath s2" d="M120 166 C124 160, 128 160, 130 154 C132 148, 126 146, 126 140" />
                    <path class="steamPath s3" d="M134 166 C138 160, 142 160, 144 154 C146 148, 140 146, 140 140" />
                  </g>
                </g>
              </svg>
            </div>

            <!-- Liz -->
            <div class="char" id="lizChar">
              <div class="nameTag" id="lizTag">üë©‚Äçü¶∞ <strong>Liz</strong> <small>chica</small></div>

              <div class="bubble right" id="lizBubble">
                <div class="who">üë©‚Äçü¶∞ Liz dice:</div>
                <div class="msg" id="lizMsg">...</div>
              </div>

              <svg id="lizSvg" class="liz" width="100%" viewBox="0 0 260 260" role="img" aria-label="Liz con caf√©">
                <defs>
                  <linearGradient id="lizDressG" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="var(--lizDress2)"/>
                    <stop offset="100%" stop-color="var(--lizDress)"/>
                  </linearGradient>
                  <radialGradient id="lizSpec" cx="30%" cy="25%" r="60%">
                    <stop offset="0%" stop-color="rgba(255,255,255,.55)"/>
                    <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                  </radialGradient>
                </defs>

                <ellipse cx="130" cy="242" rx="84" ry="16" fill="rgba(0,0,0,.10)"/>

                <path d="M78 192 C88 150, 106 128, 130 128 C154 128, 172 150, 182 192
                         C168 206, 150 214, 130 214 C110 214, 92 206, 78 192Z"
                      fill="url(#lizDressG)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>

                <path d="M82 152 C62 162, 62 184, 82 192 C92 196, 100 186, 98 174 C96 162, 90 154, 82 152Z"
                      fill="var(--lizSkin)" stroke="rgba(0,0,0,.08)" stroke-width="2"/>
                <path d="M178 152 C198 162, 198 184, 178 192 C168 196, 160 186, 162 174 C164 162, 170 154, 178 152Z"
                      fill="var(--lizSkin)" stroke="rgba(0,0,0,.08)" stroke-width="2"/>

                <circle cx="130" cy="86" r="58" fill="var(--lizSkin)" stroke="rgba(0,0,0,.10)" stroke-width="3"/>
                <ellipse cx="118" cy="70" rx="48" ry="38" fill="url(#lizSpec)" opacity=".65"/>

                <path d="M72 90 C72 48, 98 28, 130 28 C168 28, 190 52, 190 92
                         C182 76, 170 70, 160 68 C154 52, 144 46, 130 46
                         C114 46, 104 54, 98 68 C88 70, 78 74, 72 90Z"
                      fill="var(--lizHair)" opacity=".98"/>

                <g>
                  <g class="eyeNormal">
                    <circle cx="108" cy="90" r="15" fill="#fff" stroke="rgba(0,0,0,.12)" stroke-width="3"/>
                    <circle cx="152" cy="90" r="15" fill="#fff" stroke="rgba(0,0,0,.12)" stroke-width="3"/>
                    <circle class="pupilMove" cx="110" cy="93" r="6.7" fill="rgba(0,0,0,.55)"/>
                    <circle class="pupilMove" cx="154" cy="93" r="6.7" fill="rgba(0,0,0,.55)"/>
                    <circle cx="105" cy="86" r="2.8" fill="rgba(255,255,255,.95)"/>
                    <circle cx="149" cy="86" r="2.8" fill="rgba(255,255,255,.95)"/>
                  </g>

                  <g class="eyeHeart" opacity="0">
                    <path d="M96 88 C96 80, 106 80, 108 87 C110 80, 120 80, 120 88
                             C120 97, 108 102, 108 102 C108 102, 96 97, 96 88Z"
                          fill="var(--heart2)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                    <path d="M140 88 C140 80, 150 80, 152 87 C154 80, 164 80, 164 88
                             C164 97, 152 102, 152 102 C152 102, 140 97, 140 88Z"
                          fill="var(--heart2)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                  </g>
                </g>

                <g id="lizMouth">
                  <path class="mouthClosed" d="M110 114 C120 126, 140 126, 150 114"
                        fill="none" stroke="rgba(0,0,0,.22)" stroke-width="4" stroke-linecap="round"/>
                  <path class="mouthOpen" opacity="0"
                        d="M112 114 C118 134, 142 134, 148 114 C142 120, 118 120, 112 114Z"
                        fill="rgba(0,0,0,.18)"/>
                </g>

                <g id="lizCupWrap">
                  <g id="lizCup">
                    <path d="M150 192 C146 192, 142 188, 142 184 V176 C142 172, 146 170, 150 170 H184 C188 170, 192 172, 192 176 V184
                             C192 188, 188 192, 184 192 H150Z"
                          fill="var(--cup)" stroke="rgba(0,0,0,.10)" stroke-width="2"/>
                    <path d="M188 176 C200 178, 200 188, 188 188" fill="none" stroke="rgba(0,0,0,.12)" stroke-width="5" stroke-linecap="round"/>
                    <path d="M148 178 H186" stroke="rgba(0,0,0,.07)" stroke-width="4" stroke-linecap="round"/>
                    <ellipse cx="167" cy="176" rx="18" ry="5" fill="var(--coffee)" opacity=".92"/>

                    <path class="steamPath s1" d="M156 166 C160 160, 164 160, 166 154 C168 148, 162 146, 162 140" />
                    <path class="steamPath s2" d="M170 166 C174 160, 178 160, 180 154 C182 148, 176 146, 176 140" />
                    <path class="steamPath s3" d="M184 166 C188 160, 192 160, 194 154 C196 148, 190 146, 190 140" />
                  </g>
                </g>
              </svg>
            </div>
          </div>
        </div>

        <div class="panelWrap">
          <div class="panel collapsed" id="panel" role="region" aria-label="Controles">
            <div class="handleRow" id="handleRow">
              <div class="grab">
                <span class="bar" aria-hidden="true"></span>
                <span id="grabText">Controles (toca para abrir)</span>
              </div>
              <button class="miniBtn" id="togglePanel" type="button">Abrir</button>
            </div>

            <div class="panelBody" id="panelBody">
              <div class="panelRow">
                <div class="seg" role="group" aria-label="Elegir personaje">
                  <label><input type="radio" name="role" value="steve" checked> üê• Soy Steve</label>
                  <label><input type="radio" name="role" value="liz"> üë©‚Äçü¶∞ Soy Liz</label>
                </div>

                <div class="seg" role="group" aria-label="Voz">
                  <label><input type="checkbox" id="voiceToggle"> üîä Voz (leer en voz alta)</label>
                </div>

                <div class="input">
                  <input id="text" type="text" maxlength="180" placeholder="Escribe un mensaje para que lo diga el personaje‚Ä¶" />
                  <button class="btn" id="send" type="button">üí¨ Decir</button>
                </div>
              </div>

              <div class="panelRow" style="margin-top:10px; justify-content:flex-end;">
                <button class="btn" id="love" type="button">üòç Enamorados</button>
                <button class="btn" id="clink" type="button">‚òï Choque de tazas</button>
                <button class="btn" id="sip" type="button">‚òï Tomar caf√©</button>
              </div>

              <div class="hint">
                <span class="pill">üì± Tel√©fono vertical OK</span>
                <span class="pill">‚úÖ Steve & Liz completos</span>
                <span class="pill">üó£Ô∏è Steve ‚Äúhombre‚Äù / Liz ‚Äúmujer‚Äù</span>
              </div>
            </div>
          </div>
        </div>

      </div><!-- layout -->
    </div><!-- scene -->
  </div><!-- wrap -->

  <script>
    (() => {
      const scene = document.getElementById('scene');
      const stage = document.getElementById('stage');

      const panel = document.getElementById('panel');
      const handleRow = document.getElementById('handleRow');
      const togglePanelBtn = document.getElementById('togglePanel');
      const grabText = document.getElementById('grabText');

      const heartsLayer = document.getElementById('heartsLayer');
      const toast = document.getElementById('toast');

      const steveChar = document.getElementById('steveChar');
      const lizChar   = document.getElementById('lizChar');

      const steveSvg  = document.getElementById('steveSvg');
      const lizSvg    = document.getElementById('lizSvg');

      const steveTag = document.getElementById('steveTag');
      const lizTag   = document.getElementById('lizTag');

      const steveBubble = document.getElementById('steveBubble');
      const lizBubble   = document.getElementById('lizBubble');
      const steveMsg    = document.getElementById('steveMsg');
      const lizMsg      = document.getElementById('lizMsg');

      const text = document.getElementById('text');
      const send = document.getElementById('send');

      const loveBtn  = document.getElementById('love');
      const clinkBtn = document.getElementById('clink');
      const sipBtn   = document.getElementById('sip');

      const roleRadios = [...document.querySelectorAll('input[name="role"]')];
      const voiceToggle = document.getElementById('voiceToggle');

      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      let loveOn = false;
      let sipOn = false;
      let bubbleTimer = null;
      let autoHeartTimer = null;
      let microGazeTimer = null;

      let voiceOn = false;
      let voices = [];

      function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

      function isPortraitMobile(){
        return window.matchMedia('(max-width: 640px) and (orientation: portrait)').matches;
      }

      function getRole(){
        return (roleRadios.find(r => r.checked)?.value) || 'steve';
      }

      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add('show');
        clearTimeout(toast._t);
        toast._t = setTimeout(() => toast.classList.remove('show'), 1500);
      }

      // ===== FIX PRINCIPAL: ESCALA AUTOM√ÅTICA POR ALTO DEL STAGE =====
      function updateCharScale(){
        const h = stage.clientHeight;
        // base 520 (escenario c√≥modo). si baja, reduce escala pero nunca desaparece.
        let s = clamp(h / 520, 0.68, 1);
        // si panel est√° abierto en m√≥vil, baja un poquito m√°s
        if(isPortraitMobile() && !panel.classList.contains('collapsed')){
          s = clamp(s - 0.06, 0.66, 0.98);
        }
        scene.style.setProperty('--charScale', s.toFixed(3));
      }

      // Clamp a stage (para que tags/bubbles no se salgan)
      function clampToStage(el){
        const pad = 10;
        const sr = stage.getBoundingClientRect();
        const r  = el.getBoundingClientRect();

        let dx = 0, dy = 0;
        if(r.left < sr.left + pad) dx += (sr.left + pad - r.left);
        if(r.right > sr.right - pad) dx -= (r.right - (sr.right - pad));
        if(r.top < sr.top + pad) dy += (sr.top + pad - r.top);
        if(r.bottom > sr.bottom - pad) dy -= (r.bottom - (sr.bottom - pad));

        el.style.setProperty('--clampX', `${dx}px`);
        el.style.setProperty('--clampY', `${dy}px`);
      }

      function clampAllFloating(){
        clampToStage(steveTag);
        clampToStage(lizTag);
        if(steveBubble.classList.contains('show')) clampToStage(steveBubble);
        if(lizBubble.classList.contains('show')) clampToStage(lizBubble);
      }

      // Drawer
      function setPanelCollapsed(collapsed){
        panel.classList.toggle('collapsed', collapsed);
        togglePanelBtn.textContent = collapsed ? 'Abrir' : 'Cerrar';
        grabText.textContent = collapsed ? 'Controles (toca para abrir)' : 'Controles (toca para cerrar)';
        requestAnimationFrame(() => {
          updateCharScale();
          clampAllFloating();
        });
      }
      function togglePanel(){
        setPanelCollapsed(!panel.classList.contains('collapsed'));
      }
      togglePanelBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePanel(); });
      handleRow.addEventListener('click', togglePanel);

      // Auto-expand when typing on mobile
      text.addEventListener('focus', () => {
        if(isPortraitMobile()) setPanelCollapsed(false);
      });

      // Hearts
      function spawnHeart(x, y, intensity=1){
        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.style.left = `${x}px`;
        heart.style.top  = `${y}px`;

        const dur = (980 + Math.random()*1200) / intensity;
        heart.style.animationDuration = `${dur}ms`;

        const hue = 325 + Math.random()*40;
        heart.style.color = `hsla(${hue}, 95%, 66%, .95)`;

        heartsLayer.appendChild(heart);
        setTimeout(() => heart.remove(), dur + 70);
      }
      function burstHearts(cx, cy, count=14){
        for(let i=0; i<count; i++){
          spawnHeart(cx + (Math.random()-0.5)*76, cy + (Math.random()-0.5)*26, 1.15);
        }
      }

      // Bubbles
      function showBubble(who, message){
        steveBubble.classList.remove('show');
        lizBubble.classList.remove('show');

        steveBubble.style.setProperty('--clampX', '0px');
        steveBubble.style.setProperty('--clampY', '0px');
        lizBubble.style.setProperty('--clampX', '0px');
        lizBubble.style.setProperty('--clampY', '0px');

        if(who === 'steve'){
          steveMsg.textContent = message;
          steveBubble.classList.add('show');
        }else{
          lizMsg.textContent = message;
          lizBubble.classList.add('show');
        }

        requestAnimationFrame(() => clampAllFloating());

        clearTimeout(bubbleTimer);
        bubbleTimer = setTimeout(() => {
          steveBubble.classList.remove('show');
          lizBubble.classList.remove('show');
        }, 5200);
      }

      // Gaze
      function setGaze(svgEl, xPx, yPx){
        svgEl.style.setProperty('--gazeX', `${xPx}px`);
        svgEl.style.setProperty('--gazeY', `${yPx}px`);
      }

      function lookAtEachOther(ms=1600){
        steveChar.classList.add('lookRight');
        lizChar.classList.add('lookLeft');

        setGaze(steveSvg, 3.2, 0.2);
        setGaze(lizSvg,  -3.0, 0.2);

        clearTimeout(lookAtEachOther._t);
        lookAtEachOther._t = setTimeout(() => {
          steveChar.classList.remove('lookRight');
          lizChar.classList.remove('lookLeft');
          setGaze(steveSvg, 0, 0);
          setGaze(lizSvg, 0, 0);
        }, ms);
      }

      function startMicroGaze(){
        if(prefersReduced) return;
        stopMicroGaze();
        microGazeTimer = setInterval(() => {
          const sx = (Math.random()-0.5) * 1.2;
          const sy = (Math.random()-0.5) * 0.6;
          const lx = (Math.random()-0.5) * 1.2;
          const ly = (Math.random()-0.5) * 0.6;

          if(!steveChar.classList.contains('lookRight') && !steveChar.classList.contains('lookLeft')){
            setGaze(steveSvg, sx, sy);
          }
          if(!lizChar.classList.contains('lookRight') && !lizChar.classList.contains('lookLeft')){
            setGaze(lizSvg, lx, ly);
          }
        }, 650);
      }
      function stopMicroGaze(){
        if(microGazeTimer){
          clearInterval(microGazeTimer);
          microGazeTimer = null;
        }
      }

      // Talking
      function stopTalking(){
        steveSvg.classList.remove('talkingSteve');
        lizSvg.classList.remove('talkingLiz');
      }
      function startTalking(who){
        stopTalking();
        if(who === 'steve') steveSvg.classList.add('talkingSteve');
        if(who === 'liz')   lizSvg.classList.add('talkingLiz');
      }

      // Speech API
      function refreshVoices(){
        if(!('speechSynthesis' in window)) return;
        voices = window.speechSynthesis.getVoices() || [];
      }
      function getSpanishVoices(){
        if(!voices.length) return [];
        return voices.filter(v => /^es/i.test(v.lang));
      }
      function pickVoiceFor(who){
        const es = getSpanishVoices();
        if(!es.length) return voices[0] || null;
        if(es.length >= 2){
          return (who === 'liz') ? es[1] : es[0];
        }
        return es[0];
      }
      function speakText(who, message){
        if(!voiceOn) return;
        if(!('speechSynthesis' in window)) {
          showToast('‚ö†Ô∏è Tu navegador no soporta voz');
          return;
        }
        try{ window.speechSynthesis.cancel(); }catch(e){}

        const utter = new SpeechSynthesisUtterance(message);
        const v = pickVoiceFor(who);
        if(v) utter.voice = v;

        utter.lang = v?.lang || 'es-MX';
        utter.rate = 1.02;
        utter.pitch = (who === 'liz') ? 1.18 : 0.85;

        utter.onstart = () => startTalking(who);
        utter.onend   = () => stopTalking();
        utter.onerror = () => stopTalking();

        window.speechSynthesis.speak(utter);
      }

      function sayMessage(){
        const msg = (text.value || '').trim();
        if(!msg) return;

        const who = getRole();
        showBubble(who, msg);
        lookAtEachOther(1800);

        startTalking(who);
        const t = Math.min(5200, 900 + msg.length * 34);
        setTimeout(() => stopTalking(), t);

        speakText(who, msg);

        const rect = stage.getBoundingClientRect();
        burstHearts(rect.width*0.5, rect.height*0.60, 12);

        text.value = '';
        text.focus();
      }

      function toggleLove(){
        loveOn = !loveOn;
        scene.classList.toggle('loveMode', loveOn);
        loveBtn.textContent = loveOn ? 'üíû Enamorados: ON' : 'üòç Enamorados';

        const rect = stage.getBoundingClientRect();
        if(loveOn){
          burstHearts(rect.width*0.5, rect.height*0.58, 20);
          showToast('üíû Ojos de coraz√≥n');
        }else{
          showToast('üôÇ Ojos normales');
        }
      }

      function clinkCups(){
        lookAtEachOther(1200);
        showBubble('steve', '¬°Salud! ‚òï‚ú®');
        setTimeout(() => showBubble('liz', '¬°Salud, Steve! ü•∞‚òï'), 300);

        const rect = stage.getBoundingClientRect();
        burstHearts(rect.width*0.5, rect.height*0.62, 18);
        showToast('‚òï ¬°Choque de tazas!');
      }

      function toggleSip(){
        if(prefersReduced) return;

        sipOn = true;
        steveSvg.classList.add('sipSteve');
        lizSvg.classList.add('sipLiz');

        sipBtn.textContent = '‚òï Tomando‚Ä¶';
        showToast('‚òï Cafecito calentito');
        lookAtEachOther(1400);

        setTimeout(() => {
          sipOn = false;
          steveSvg.classList.remove('sipSteve');
          lizSvg.classList.remove('sipLiz');
          sipBtn.textContent = '‚òï Tomar caf√©';
        }, 3600);
      }

      function startAutoHearts(){
        if(prefersReduced) return;
        stopAutoHearts();
        autoHeartTimer = setInterval(() => {
          const rect = stage.getBoundingClientRect();
          const x = rect.width*(0.5 + (Math.random()-0.5)*0.22);
          const y = rect.height*(0.62 + (Math.random()-0.5)*0.07);
          spawnHeart(x, y, 1.0);
        }, 520);
      }
      function stopAutoHearts(){
        if(autoHeartTimer){
          clearInterval(autoHeartTimer);
          autoHeartTimer = null;
        }
      }

      stage.addEventListener('pointerdown', (e) => {
        const rect = stage.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        burstHearts(x, y, 14);
      });

      send.addEventListener('click', sayMessage);
      text.addEventListener('keydown', (e) => { if(e.key === 'Enter') sayMessage(); });
      loveBtn.addEventListener('click', toggleLove);
      clinkBtn.addEventListener('click', clinkCups);
      sipBtn.addEventListener('click', toggleSip);

      voiceToggle.addEventListener('change', () => {
        voiceOn = !!voiceToggle.checked;
        if(voiceOn){
          refreshVoices();
          if('speechSynthesis' in window){
            window.speechSynthesis.onvoiceschanged = () => refreshVoices();
          }
          showToast('üîä Voz activada');
        }else{
          try{ window.speechSynthesis.cancel(); }catch(e){}
          showToast('üîá Voz desactivada');
        }
      });

      if('speechSynthesis' in window){
        refreshVoices();
        window.speechSynthesis.onvoiceschanged = () => refreshVoices();
      }

      const ro = new ResizeObserver(() => {
        updateCharScale();
        requestAnimationFrame(() => clampAllFloating());
      });
      ro.observe(stage);
      ro.observe(panel);

      window.addEventListener('resize', () => {
        updateCharScale();
        requestAnimationFrame(() => clampAllFloating());
        if(isPortraitMobile()) setPanelCollapsed(true);
      });

      // INIT
      updateCharScale();
      requestAnimationFrame(() => clampAllFloating());

      if(isPortraitMobile()){
        setPanelCollapsed(true);
      } else {
        setPanelCollapsed(false);
      }

      showBubble('steve', '¬°Hola Liz! ‚òï‚ú®');
      lookAtEachOther(1600);
      setTimeout(() => showBubble('liz', '¬°Hola Steve! Qu√© linda cita ü•∞'), 1100);

      startAutoHearts();
      startMicroGaze();

      if(prefersReduced){
        stopAutoHearts();
        stopMicroGaze();
        showToast('üßò Modo tranquilo');
      }
    })();
  </script>
</body>
</html>
